<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		MQL4零基础课程 | 
	 
	Ai Trading
	</title>
	
	<!-- keywords,description -->
	 
		<meta name="description" content="致力于智能量化交易" />
	

	<!-- favicon -->
	
	<link rel="shortcut icon" href="../favicon.ico">
	
  

	<link rel="stylesheet" href="../css/main.css">
	<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

	<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>
	<script src="../js/main.js"></script>
	
		<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>
	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
</head>

<body>
	<header id="header">
    <a id="title" href="../index.html" class="logo">Ai Trading</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="https://aijy.github.io" class="menu-item-link"  target="_blank">返回主页</a>
		</li>

		<li class="menu-item">
			<a href="/about" class="menu-item-link">关于课程</a>
		</li>
		
		<li class="menu-item">
			<a href="https://github.com/aijy/MQL4_TUT" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="text" placeholder="search...">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										MQL4进阶课程
									</a>
									
							<ul>
								<li class="file">
									<a href="../MQL4进阶课程/MQL4进阶课程.html">
										MQL4进阶课程
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										MQL4零基础课程
									</a>
									
							<ul>
								<li class="file active">
									<a href="">
										MQL4零基础课程
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										常见问题与解答
									</a>
									
							<ul>
								<li class="file">
									<a href="../常见问题与解答/常见问题与解答.html">
										常见问题与解答
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="../近期更新计划.html">
										近期更新计划
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">

	MQL4零基础课程
</h1>
<div class="article-meta">
	
	<span>时应盼</span>
	<span>2020-11-13 08:00:00</span>
    
		<div id="article-categories">
            
                
                    <span>
                        <i class="fa fa-folder" aria-hidden="true"></i>
                        <a href="/categories/MQL4课程/">MQL4课程</a>
						
                    </span>
                
            
		</div>
    
</div>

<div id="article-content">
	<h2 id="MT4自动交易系统简介"><a href="#MT4自动交易系统简介" class="headerlink" title="MT4自动交易系统简介"></a>MT4自动交易系统简介</h2><p>所谓EA外汇自动交易系统，就是将外汇交易策略用编程语言（MQL）编写成一个电脑软件程序（Expert Advisor）, 让电脑按照事先设定好的条件自动地交易。<br>EA交易的优点：</p>
<ul>
<li>自动下单，可以保证更快的下单，更敏感地响应价格变动和趋势变动。</li>
<li>避免情绪化操作。</li>
<li>时时监控行情，并在适当的时机和点位自动进出场，也可作为提示工具使用。</li>
<li>历史回测，辅助完善策略</li>
</ul>
<p>目标：MT4平台EA基本操作，编写简单的程序化交易代码。<br>适用：对程序化交易感兴趣，入门级教程，有无编程经验均可。<br>总体安排：MT4入门 -&gt; MT4进阶 -&gt; MT5入门 -&gt; MT5进阶<br>注：想学习程序化交易，MT4是非常好的学习和实践工具。开源分享，不足之处请海涵！</p>
<h3 id="软件操作"><a href="#软件操作" class="headerlink" title="软件操作"></a>软件操作</h3><ul>
<li>EA运行许可</li>
<li>EA的加载、运行、卸载和状态显示</li>
</ul>
<h3 id="编辑器操作"><a href="#编辑器操作" class="headerlink" title="编辑器操作"></a>编辑器操作</h3><ul>
<li>新建脚本<br>脚本可以进行订单操作，在页面加载只执行一次，无需卸载。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">   脚本主体</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>新建指标<br>自定义指标的编写比较复杂，将在进阶课程中讲解。</li>
<li>新建EA</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EA初始化函数，在EA执行前需要确定的事情需要写在这个函数里面，比如网络连接是否正常，账户是否是确定账户等。</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">OnInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">   <span class="keyword">return</span>(INIT_SUCCEEDED);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个函数是EA卸载时执行的代码，一般不用，但保留格式</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnDeinit</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> reason)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 程序的主体内容写在这个函数里面，这个函数在图表货币对每次报价的时候执行一次。如果报价不变就不会执行，即周末的时候，报价不变，代码也不会执行。</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnTick</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>MQL4文件夹<br>MQL4文件夹是MT4平台涉及智能交易的文件夹，其中EA，指标和脚本分别处于不同的文件夹中，放错位置将无法执行。</p>
<ul>
<li>Experts    ：存放EA</li>
<li>Files      ：MQL4可以进行文件操作，文件一般会在这个文件夹中</li>
<li>Images     ： 用不到</li>
<li>Include    ：函数库文件夹，用于存放函数库文件，在写EA和脚本时可以调用这个文件中的函数</li>
<li>Indicators ：指标文件夹，存放指标</li>
<li>Libraries  ：动态链接库文件夹，借用动态链接库文件可扩展MQL4的功能</li>
<li>Logs       ：日志文件夹，运行EA的日志存放在这个地方</li>
<li>Presets    ：EA的参数可以保存，放在这个文件夹中</li>
<li>Project    ：用不到</li>
<li>Scripts    ：脚本文件夹，存放脚本 </li>
</ul>
</li>
<li><p>MetaEditor编辑器操作<br>MetaEditor编辑器是专门用于编写MQL4语言的编辑器，需要掌握以下功能：</p>
<ul>
<li>新建文档     : 创建新文件</li>
<li>编译文档     : 编写写好的代码</li>
<li>查看编译信息 ： 查看错误信息，调试代码</li>
<li>打开导航栏   : 方便查找文件</li>
<li>查看帮助文件 ： 帮助操作(F1)</li>
</ul>
</li>
</ul>
<h3 id="脚本示例"><a href="#脚本示例" class="headerlink" title="脚本示例"></a>脚本示例</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将下面的代码复制到脚本中，这是一个下单指令，这是个以当前价格当前货币对开0.1手多单且无止损止盈的下单脚本</span></span><br><span class="line">   <span class="keyword">if</span>(OrderSend(Symbol(),OP_BUY,<span class="number">0.1</span>,Ask,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">"多单"</span>,<span class="number">123</span>,<span class="number">0</span>,clrNONE))</span><br><span class="line">     &#123;</span><br><span class="line">      Print(<span class="string">"下单成功了！"</span>);</span><br><span class="line">     &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">     &#123;</span><br><span class="line">      Alert(<span class="string">"下单失败了！原因："</span>,GetLastError());</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<h2 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h2><h3 id="EA的基本结构"><a href="#EA的基本结构" class="headerlink" title="EA的基本结构"></a>EA的基本结构</h3><p>初始化：在持续运行之前，运行一次</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-- 以下按照1,2,3,4的顺序执行代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//--- 1.全局变量和常量定义区域</span></span><br><span class="line">input <span class="keyword">double</span> 首单单量=<span class="number">1.0</span>; <span class="comment">//-- 输入变量输入变量</span></span><br><span class="line"><span class="keyword">double</span> 次单单量=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">//|                                                                  |</span></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">OnInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//--- 2.初始化参数区域，只执行一次，此处失败，程序自动卸载</span></span><br><span class="line">   <span class="keyword">if</span>(首单单量&gt;<span class="number">1</span>)</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">return</span>(INIT_FAILED);</span><br><span class="line">     &#125;</span><br><span class="line">   次单单量 = 首单单量*<span class="number">2</span>;</span><br><span class="line">   Print(<span class="string">"初试化完成，首单单量是："</span>,首单单量,<span class="string">" 次单单量是："</span>,次单单量);</span><br><span class="line">   <span class="keyword">return</span>(INIT_SUCCEEDED);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">//| Expert deinitialization function                                 |</span></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnDeinit</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> reason)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//--- 4.程序卸载时执行一次，一般为空</span></span><br><span class="line">   Print(<span class="string">"程序卸载"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">//| Expert tick function                                             |</span></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnTick</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//--- 3.币种图表，每次报价时执行一次，无限循环</span></span><br><span class="line">   cnt = cnt+<span class="number">1</span>;</span><br><span class="line">   PrintFormat(<span class="string">"程序正在执行。当前时间：%s,当前为第%d次执行"</span>,TimeToStr(TimeCurrent(),TIME_DATE|TIME_MINUTES|TIME_SECONDS),cnt);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>
<h3 id="脚本的基本结构"><a href="#脚本的基本结构" class="headerlink" title="脚本的基本结构"></a>脚本的基本结构</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">   <span class="comment">// 执行一次</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><h4 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h4><p>整数是不带小数的数字，包含负整数，零和正整数。</p>
<ul>
<li>整数的定义：int a=10;</li>
<li>整数转化为浮点数： b=double(a);</li>
<li>整数转化为字符串： string c=IntegerToString(a);</li>
<li>整除：整数除整数，结果仍然是整数，整数除浮点数，结果为浮点数。int a=1,b=2; Print(a/b);结果为0</li>
</ul>
<h4 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h4><p>浮点数是带有小数部分的数字。</p>
<ul>
<li>浮点数的定义：double a=10;</li>
<li>浮点数转化为整数： b=int(a);只保留整数部分</li>
<li>浮点数转化为字符串： string c=DoubleToString(a，2);2表示保留2位小数</li>
</ul>
<h4 id="布尔量"><a href="#布尔量" class="headerlink" title="布尔量"></a>布尔量</h4><p>布尔量是表示真假的量，只有True（真）和False（假）两种情况。</p>
<p>布尔量的定义：bool a=True;<br>布尔量一般不做类型转换。</p>
<h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><p>字符串可以理解为一段文字，可以是英文或中文。</p>
<ul>
<li>字符串的定义：string a=”你好”；字符串需要用英文引号包含起来。</li>
<li>字符串转化为整型 :如果字符串中都是整数可转化为整数，b=StringToInteger(a)</li>
<li>字符串转化为浮点数：如果字符串是浮点数，则可以转化为浮点数，b=StringToDouble(a)</li>
<li>字符串转化为时间量 : 如果字符串是日期，则可以转化为时间量，b=StringToTime()</li>
<li>字符串的拼接：string a =”你”，b=”好”; c=a+b; Print(c); “你好”</li>
</ul>
<h4 id="时间量"><a href="#时间量" class="headerlink" title="时间量"></a>时间量</h4><p>时间量是MQL4表示时间的变量。</p>
<ul>
<li>时间量的定义：datetime a=D’2017.12.25 12:12:00’; 时，分，秒可以不写，默认为00:00:00</li>
<li>时间戳：以1970.01.01 为0，到现在的秒数，所以时间量也可以是整型，参与数学运算。</li>
<li>时间量转化为字符串：b=TimeToString(a)</li>
</ul>
<h4 id="颜色变量"><a href="#颜色变量" class="headerlink" title="颜色变量"></a>颜色变量</h4><p>在MQL4中表示颜色的量，一般是使用的可用以下几种</p>
<ul>
<li>红色：clrRed</li>
<li>黄色：clrYellow</li>
<li>白色：clrWhite</li>
<li>绿色：clrGreen</li>
<li>无颜色：clrNone</li>
</ul>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>变量,是指没有固定的值,在程序中可以改变的数。与之相对应的是常量，即一旦设定，在整个程序中的值都不会变，也不允许改变。</p>
<p><strong>注：程序中所有变量都需要先定义，后使用。</strong></p>
<h4 id="变量的定义"><a href="#变量的定义" class="headerlink" title="变量的定义"></a>变量的定义</h4><p>变量的定义，有三个部分组成：</p>
<p>数据类型 变量名=初始值 结束符</p>
<ul>
<li>数据类型：表明变量属于哪一类</li>
<li>变量名：是字母a-z,A-Z，数字0-9，以及“_”的组合，不能以数字开头。</li>
<li>结束符：分号“;”。分号必须为英文分号，代码中所有字符（除注释）必须为英文字符。</li>
</ul>
<h4 id="常量的定义"><a href="#常量的定义" class="headerlink" title="常量的定义"></a>常量的定义</h4><p>常量的定义，有三部分</p>
<p>#define 常量名 常量值 </p>
<ul>
<li>常量使用#define定义</li>
<li>常量需在程序开始时定义。</li>
<li>不需要结束符</li>
<li>常量的变量名，不能够再定义成变量</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----常量的定义----//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 10 <span class="comment">//常量标识符(#define) 常量名(N) 常量值(10) 注：不需要分号结束</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----变量的定义----//</span></span><br><span class="line"><span class="keyword">int</span> var=<span class="number">1</span>; <span class="comment">//数据类型(int) 变量名(var)=初始值(1) 结束符(;)</span></span><br><span class="line"><span class="keyword">double</span> lot=<span class="number">1.2</span>; <span class="comment">//数据类型(double) 变量名(lot)=初始值(1.2) 结束符(;)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//----- 整数-----//</span></span><br><span class="line">   <span class="keyword">int</span> a=<span class="number">1</span>,b=<span class="number">2</span>,c;</span><br><span class="line">   c=a+b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a+b="</span>,c);</span><br><span class="line">   c=a-b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a-b="</span>,c);</span><br><span class="line">   c=a*b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a*b="</span>,c);</span><br><span class="line">   c=a/b; <span class="comment">//----这是整除----//</span></span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a/b="</span>,c);</span><br><span class="line">   c=a%b; </span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a%b="</span>,c);</span><br><span class="line"><span class="comment">//----- 浮点数-----//</span></span><br><span class="line">   <span class="keyword">double</span> d=<span class="number">1</span>,e=<span class="number">2</span>,f;</span><br><span class="line">   f=d+e;</span><br><span class="line">   Print(<span class="string">"d="</span>,d,<span class="string">",e="</span>,e,<span class="string">",d+e="</span>,f);</span><br><span class="line">   f=d-e;</span><br><span class="line">   Print(<span class="string">"d="</span>,d,<span class="string">",e="</span>,e,<span class="string">",d-e="</span>,f);</span><br><span class="line">   f=d*e;</span><br><span class="line">   Print(<span class="string">"d="</span>,d,<span class="string">",e="</span>,e,<span class="string">",d*e="</span>,f);</span><br><span class="line">   f=d/e;</span><br><span class="line">   Print(<span class="string">"d="</span>,d,<span class="string">",e="</span>,e,<span class="string">",d/e="</span>,f);</span><br><span class="line"></span><br><span class="line"><span class="comment">//----- 布尔量-----//</span></span><br><span class="line">   <span class="keyword">bool</span> g=<span class="literal">true</span>,h=<span class="literal">false</span>,i;</span><br><span class="line">   </span><br><span class="line">   i= g &amp;&amp; h;</span><br><span class="line">   Print(<span class="string">"g="</span>,g,<span class="string">",h="</span>,h,<span class="string">",g/h="</span>,i);</span><br><span class="line">   </span><br><span class="line">   i= g || h;</span><br><span class="line">   Print(<span class="string">"g="</span>,g,<span class="string">",h="</span>,h,<span class="string">",g/h="</span>,i);</span><br><span class="line"></span><br><span class="line"><span class="comment">//----- 字符串-----//</span></span><br><span class="line">   <span class="built_in">string</span> j=<span class="string">"ni"</span>,k=<span class="string">"hao"</span>,m;</span><br><span class="line">   m=j+k;</span><br><span class="line">   Print(<span class="string">"j="</span>,j,<span class="string">",k="</span>,k,<span class="string">",j/k="</span>,m);</span><br><span class="line"></span><br><span class="line"><span class="comment">//----- 时间量-----//</span></span><br><span class="line">   datetime now;</span><br><span class="line">   now=TimeCurrent();</span><br><span class="line">   Print(<span class="string">"now="</span>,now,<span class="string">"now_int="</span>,<span class="keyword">int</span>(now));</span><br><span class="line">   now=now<span class="number">-60</span>;   <span class="comment">//----时间量可以转化为整型作为时间的计算方式，1个单位代表1秒</span></span><br><span class="line">   Print(<span class="string">"now-60="</span>,now);</span><br><span class="line">   </span><br><span class="line"><span class="comment">//----- 颜色变量-----//</span></span><br><span class="line"><span class="comment">// 颜色变量一般不定义，直接使用。   </span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><h4 id="加"><a href="#加" class="headerlink" title="加"></a>加</h4><ul>
<li>数字相加 </li>
<li>自加 （a++）         </li>
<li>时间相加</li>
<li>字符串相加</li>
</ul>
<h4 id="减"><a href="#减" class="headerlink" title="减"></a>减</h4><ul>
<li>数字减</li>
<li>自减 （a–）</li>
<li>时间减</li>
</ul>
<h4 id="乘"><a href="#乘" class="headerlink" title="乘"></a>乘</h4><p>在程序中，乘法符号用”<em>“(shift+8)表示 int a=1,b=2; double c=a</em>b; Print(c);输出 2</p>
<h4 id="除"><a href="#除" class="headerlink" title="除"></a>除</h4><p>在程序中，除法符号用”/“表示，除数不能为零。 int a=1;double b=2; double c=a/b;Print(c);输出 0.5</p>
<h4 id="取余数"><a href="#取余数" class="headerlink" title="取余数"></a>取余数</h4><p>取余数，又称为模运算，在程序中有重要的作用，取余数的符号是”%”(shift+5)，取余数的双方必须是整数。余数，类似于3除2，余1。</p>
<h4 id="指数运算"><a href="#指数运算" class="headerlink" title="指数运算"></a>指数运算</h4><p>指数运算需要使用到系统自带的函数：MathPow(底数，次方数)。</p>
<h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><p>逻辑运算符是配合控制语句使用。其运算结果是布尔量，只有“真”或“假”。</p>
<ul>
<li>==：等于等于，若两边一致，则为 True（真），否则为False（假）</li>
<li>！=：不等于，若两边不一致，则为True(真)，否则为False（假）</li>
<li>>  :大于，左边大于右边为True（真），否则为False（假）</li>
<li>>= :大于等于，左边大于或等于右边为True（真），否则为False（假）</li>
<li>&lt;  :小于，左边小于于右边为True（真），否则为False（假）</li>
<li>&lt;= :小于等于，左边小于或等于右边为True（真），否则为False（假）</li>
<li>&amp;&amp; :逻辑与，左边和右边都为True(真)时，结果为True(真)，否则为False（假）</li>
<li>|| :逻辑或，左边和右边都为False（假）时，结果为False（假），否则为True（真）。</li>
<li>！：非操作，也称取反操作。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//-------加-------// </span></span><br><span class="line">   <span class="keyword">int</span> a=<span class="number">1</span>;</span><br><span class="line">   <span class="keyword">double</span> b=<span class="number">2</span>,c;</span><br><span class="line">   c=a+b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a+b="</span>,c);</span><br><span class="line">   </span><br><span class="line">   <span class="built_in">string</span> j=<span class="string">"ni"</span>,k=<span class="string">"hao"</span>,m;</span><br><span class="line">   m=j+k;</span><br><span class="line">   Print(<span class="string">"j="</span>,j,<span class="string">",k="</span>,k,<span class="string">",j/k="</span>,m);  </span><br><span class="line">   </span><br><span class="line">   Print(<span class="string">"a="</span>,a);</span><br><span class="line">   a++;          <span class="comment">//自加1</span></span><br><span class="line">   Print(<span class="string">"a"</span>,a);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//-------减-------//</span></span><br><span class="line">   c=a-b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a-b="</span>,c);</span><br><span class="line">   </span><br><span class="line">   Print(<span class="string">"a="</span>,a);</span><br><span class="line">   a--;          <span class="comment">//自加1</span></span><br><span class="line">   Print(<span class="string">"a"</span>,a);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//-------乘-------// </span></span><br><span class="line">   c=a*b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a*b="</span>,c);</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------除-------// </span></span><br><span class="line">   <span class="keyword">int</span> aa=<span class="number">1</span>,bb=<span class="number">2</span>,cc;</span><br><span class="line">   cc=aa/bb; <span class="comment">//----这是整除----//</span></span><br><span class="line">   Print(<span class="string">"aa="</span>,aa,<span class="string">",bb="</span>,bb,<span class="string">",aa/bb="</span>,cc);</span><br><span class="line">   <span class="keyword">double</span> d=<span class="number">1</span>,e=<span class="number">2</span>,f;</span><br><span class="line">   f=d/e; <span class="comment">//----结果带小数---//</span></span><br><span class="line">   Print(<span class="string">"d="</span>,d,<span class="string">",e="</span>,e,<span class="string">",d/e="</span>,f);</span><br><span class="line"><span class="comment">//-------取余-------// </span></span><br><span class="line">   cc=aa%bb; <span class="comment">//----这是整除取余----//</span></span><br><span class="line">   Print(<span class="string">"aa="</span>,aa,<span class="string">",bb="</span>,bb,<span class="string">",aa%bb="</span>,cc);</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------指数运算-------//</span></span><br><span class="line">   c=MathPow(b,a); <span class="comment">//----b的a次方----//</span></span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",b^a="</span>,c);</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------逻辑运算-------// </span></span><br><span class="line">   <span class="keyword">bool</span> r;</span><br><span class="line">   r= a&gt;b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a&gt;b="</span>,r); </span><br><span class="line">   r=!(a&gt;b);</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a&gt;b="</span>,r); </span><br><span class="line">   r= a&gt;=b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a&gt;=b="</span>,r); </span><br><span class="line">   r= a&lt;b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a&lt;b="</span>,r); </span><br><span class="line">   r= a&lt;=b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a&lt;=b="</span>,r);       </span><br><span class="line">   r= a==b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a==b="</span>,r); </span><br><span class="line">   r= a&gt;b || a==b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a&gt;b || a==b="</span>,r); </span><br><span class="line">   r= a&gt;=b || a==b;</span><br><span class="line">   Print(<span class="string">"a="</span>,a,<span class="string">",b="</span>,b,<span class="string">",a&gt;=b || a==b="</span>,r); </span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="变量名"><a href="#变量名" class="headerlink" title="变量名"></a>变量名</h3><ul>
<li>良好的变量名有助于读懂代码，修改代码。</li>
<li>变量名必须以字母或下划线起始，不能以数字起始，不能使用关键字，不推荐使用中文。</li>
</ul>
<h3 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h3><p>每种编程语言都会有些关键字，是保留下来的，不能够当变量名使用。保留字都有特定的颜色。不能够使用保留字的名称作为变量。</p>
<ul>
<li>类型保留字</li>
<li>函数保留字</li>
<li>订单保留字</li>
<li>其他保留字</li>
</ul>
<h3 id="结束符"><a href="#结束符" class="headerlink" title="结束符"></a>结束符</h3><p>在程序主体中，每句代码的结束，都要以英文分号”;”结束。</p>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>程序中注释不会影响程序的运行。</p>
<ul>
<li>注释一行：使用”//“</li>
<li>注释一段：使用”//<em> 注释内容 /</em>/“</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//保留字，系统留用。保留字有特殊的颜色</span></span><br><span class="line"><span class="comment">//类型</span></span><br><span class="line"><span class="keyword">int</span>,<span class="keyword">double</span>,datetime,<span class="built_in">string</span></span><br><span class="line"><span class="comment">//函数</span></span><br><span class="line">OrderSend(),OrderClose(),OnStart();</span><br><span class="line"><span class="comment">//订单</span></span><br><span class="line">OP_BUY,OP_SELL</span><br><span class="line"><span class="comment">//其他保留字</span></span><br><span class="line">Ask,Bid </span><br><span class="line"><span class="comment">//中文字符  </span></span><br><span class="line">注意中文字符的颜色，MQL4支持中文字符。  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//结束符</span></span><br><span class="line">每句代码的结束都要以英文分号(;)结束</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment">// 这是一行注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">这是一段注释</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="控制语句"><a href="#控制语句" class="headerlink" title="控制语句"></a>控制语句</h2><p>控制语句是实现策略的主要方法，在程序中非常重要，控制语句的执行代码需要用大括号括起来。</p>
<h3 id="if条件判断"><a href="#if条件判断" class="headerlink" title="if条件判断"></a>if条件判断</h3><p>if是条件判断语句，若条件为True（真）时，执行if内容，否则不执行。</p>
<h3 id="if-else条件判断"><a href="#if-else条件判断" class="headerlink" title="if-else条件判断"></a>if-else条件判断</h3><p>若if判断条件为真，执行if的内容，否则执行else里面的内容。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//-----23点到1点之间不交易------//</span></span><br><span class="line">   <span class="keyword">if</span>(TimeHour(TimeCurrent())==<span class="number">23</span> || TimeHour(TimeCurrent())==<span class="number">0</span>) <span class="comment">//--函数带有括号()</span></span><br><span class="line">   &#123;</span><br><span class="line">      Alert(<span class="string">"非交易时段"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">//--- else 并不是一定要有，根据需要-------//</span></span><br><span class="line"><span class="comment">//--- 本根K线RSI指标高于50下空单，低于50下多单----//</span></span><br><span class="line">   <span class="keyword">double</span> rsi_value=iRSI(Symbol(),<span class="number">0</span>,<span class="number">14</span>,PRICE_CLOSE,<span class="number">0</span>);</span><br><span class="line">   <span class="keyword">int</span> ticket=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">if</span>(rsi_value&gt;<span class="number">50</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      ticket=OrderSend(Symbol(),OP_SELL,<span class="number">0.1</span>,Bid,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">"测试"</span>,<span class="number">1242</span>,<span class="number">0</span>,clrNONE);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span>(ticket==<span class="number">0</span>)</span><br><span class="line">         Print(<span class="string">"开单失败！错误原因："</span>,GetLastError());</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         Print(<span class="string">"开单成功！订单号："</span>,ticket);      </span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">      ticket=OrderSend(Symbol(),OP_BUY,<span class="number">0.1</span>,Ask,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">"测试"</span>,<span class="number">1242</span>,<span class="number">0</span>,clrNONE);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span>(ticket==<span class="number">0</span>)</span><br><span class="line">         Print(<span class="string">"开单失败！错误原因："</span>,GetLastError());</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         Print(<span class="string">"开单成功！订单号："</span>,ticket); </span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">//--- 本根K线RSI指标高于70下空单，低于30下多单,其他情况不下单----// </span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(rsi_value&gt;<span class="number">70</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      ticket=OrderSend(Symbol(),OP_SELL,<span class="number">0.1</span>,Bid,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">"测试"</span>,<span class="number">1242</span>,<span class="number">0</span>,clrNONE);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span>(ticket==<span class="number">0</span>)</span><br><span class="line">         Print(<span class="string">"开单失败！错误原因："</span>,GetLastError());</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         Print(<span class="string">"开单成功！订单号："</span>,ticket);      </span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span>(rsi_value&lt;<span class="number">30</span>)   <span class="comment">// else if 追加判断</span></span><br><span class="line">   &#123;</span><br><span class="line">      ticket=OrderSend(Symbol(),OP_BUY,<span class="number">0.1</span>,Ask,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">"测试"</span>,<span class="number">1242</span>,<span class="number">0</span>,clrNONE);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span>(ticket==<span class="number">0</span>)</span><br><span class="line">         Print(<span class="string">"开单失败！错误原因："</span>,GetLastError());</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         Print(<span class="string">"开单成功！订单号："</span>,ticket); </span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><p>for循环，在任何编程语言中都占据重要的地位。很复杂的类似操作，使用for循环将会变得简单。<br>for循环需要定义循环次数，通常情况下使用如下：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//-----做1到100的累加----//</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">100</span>;i++)</span><br><span class="line">   &#123;</span><br><span class="line">      sum=sum+i;</span><br><span class="line">   &#125;</span><br><span class="line">   Print(<span class="string">"1到100的累加结果为："</span>,sum);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">int</span> i=<span class="number">1</span>;</span><br><span class="line">   sum=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">while</span>(i&lt;=<span class="number">100</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      sum=sum+i;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   Print(<span class="string">"1到100的累加结果为："</span>,sum);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h3><p>while循环是一直循环，只要条件满足就执行，在没有停止条件的情况下会一直执行。没有停止条件的情况下，会无限循环，导致程序陷入死循环，有时会崩溃。在可选的条件下，尽量不用。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//-----做1到100的累加----//</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">int</span> i=<span class="number">1</span>;</span><br><span class="line">   <span class="keyword">while</span>(i&lt;=<span class="number">100</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      sum=sum+i;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   Print(<span class="string">"1到100的累加结果为："</span>,sum);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="switch-case条件选择"><a href="#switch-case条件选择" class="headerlink" title="switch-case条件选择"></a>switch-case条件选择</h3><p>根据switch的内容，选定相应的case。使用switch-case时，需要事情拟定所有可能的情况。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//-----选择下单方式----//</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">int</span> type=OP_BUY;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">switch</span>(type)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">case</span> OP_BUY:</span><br><span class="line">         Print(<span class="string">"下多单"</span>);</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> OP_BUYLIMIT:</span><br><span class="line">         Print(<span class="string">"下限价买入挂单"</span>);</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> OP_SELL:      </span><br><span class="line">         Print(<span class="string">"下空单"</span>);</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">         Print(<span class="string">"其他情况，不操作"</span>);</span><br><span class="line">         <span class="keyword">break</span>;   </span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="continue-循环中断"><a href="#continue-循环中断" class="headerlink" title="continue 循环中断"></a>continue 循环中断</h3><p>在循环语句的代码中，执行到continue时，将直接进入下一次循环。</p>
<h3 id="break-循环结束"><a href="#break-循环结束" class="headerlink" title="break 循环结束"></a>break 循环结束</h3><p>在循环语句的代码中，执行到break时，循环将被终止。</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>函数本质上是一段代码，只不过这段代码经常被使用或者这段代码实现特定的功能。函数并不是一定要用，用了有以下优势：</p>
<ul>
<li>代码框架清晰</li>
<li>代码重用性提高，减少代码量</li>
<li>函数可以嵌套函数，可实现递归</li>
</ul>
<h3 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h3><p>自定义函数用于实现特定的功能。函数有以下属性</p>
<ul>
<li><p>函数的形式：函数需写在主体程序之外，如下：</p>
</li>
<li><p>返回值：函数可以带有返回值，定义类型与返回类型需一致。</p>
</li>
<li><p>无返回值：对于不需要返回值的函数，定义类型用void。</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*----函数的基本结构-----//</span></span><br><span class="line"><span class="comment">返回值类型 函数名(参数类型 参数定义,参数类型 参数定义)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">   函数主体，执行特定功能</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 10 </span></span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span> ; <span class="comment">//-- 全局变量，任何地方都可调用。全局变量和局部变量名不要相同，以免混淆</span></span><br><span class="line"><span class="keyword">int</span> sum_array[N]; <span class="comment">//-- 数组放多个数据，主要与循环配合使用,数组长度必须固定</span></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">//| OnStart()也是一个函数，并且没有返回值                               |</span></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">   Acc_check(); <span class="comment">//---没有参数</span></span><br><span class="line">   <span class="keyword">int</span> a=<span class="number">1</span>,b=<span class="number">2</span>,c=<span class="number">3</span>,res;</span><br><span class="line">   res = add(a,b,c,<span class="number">4</span>);<span class="comment">//---有4个参数，与函数定义需一一对应</span></span><br><span class="line">   Print(<span class="string">"res:"</span>,res);</span><br><span class="line">   sum = res;</span><br><span class="line">   display();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Acc_check</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(!IsDemo())</span><br><span class="line">   &#123;</span><br><span class="line">      Alert(<span class="string">"非模拟账户，请谨慎操作！"</span>);</span><br><span class="line">   &#125;   </span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> aa,<span class="keyword">int</span> bb,<span class="keyword">int</span> cc,<span class="keyword">int</span> dd)</span> <span class="comment">//-- aa,bb,cc,dd 是形式参数，传进来的值是真实参数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> r=<span class="number">0</span>;           <span class="comment">//-- 局部变量，只在函数内起作用</span></span><br><span class="line">   r=aa+bb+cc+dd;</span><br><span class="line">   <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   Print(<span class="string">"sum值是："</span>,sum);</span><br><span class="line">   <span class="comment">//Print("r值是：",r);</span></span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">   &#123;</span><br><span class="line">      sum_array[i]=sum+<span class="number">1</span>;</span><br><span class="line">      PrintFormat(<span class="string">"sum_array[%d]值是：%d"</span>,i,sum_array[i]);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="下单函数"><a href="#下单函数" class="headerlink" title="下单函数"></a>下单函数</h3><p>MQL4中只有一个下单函数：Ordersend()，下单函数的属性，参照订单参数。</p>
<p>发送订单时，币种是必须要给予的。币种的类型是string（字符串类型的），可以有以下几种表现形式：</p>
<ul>
<li>调用Symbol()：Symbol()函数是MQL4内部定义函数，返回当前加载EA图表中的币种。</li>
<li>直接指定：使用字符串指定，如欧元兑美元可直接使用”EURUSD”</li>
<li>间接指定：定义一个货币对字符串，然后使用这个字符串</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">   <span class="built_in">string</span> 币种=Symbol(),注释=<span class="string">"测试"</span>;</span><br><span class="line">   <span class="keyword">double</span> 单量=<span class="number">0.1</span>,开仓价=Ask;</span><br><span class="line">   <span class="keyword">int</span> 滑点=<span class="number">3</span>,魔数=<span class="number">1243</span>;</span><br><span class="line">   <span class="keyword">double</span> 止损=开仓价<span class="number">-100</span>*Point,止盈=开仓价+<span class="number">100</span>*Point;</span><br><span class="line">   datetime 过期时间=<span class="number">0</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">int</span> ticket=<span class="number">0</span>;</span><br><span class="line">   ticket=OrderSend(币种,OP_BUY,单量,开仓价,滑点,止损,止盈,注释,魔数,过期时间,clrNONE);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span>(ticket==<span class="number">0</span>)</span><br><span class="line">      Print(<span class="string">"开单失败！错误原因："</span>,GetLastError());</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">      Print(<span class="string">"开单成功！订单号："</span>,ticket);   </span><br><span class="line">      </span><br><span class="line">   GetSymInfo();  </span><br><span class="line"> </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//----获得币种的各种信息----//</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetSymInfo</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="built_in">string</span> 货币对名=<span class="string">"EURUSD"</span>;</span><br><span class="line">   <span class="keyword">double</span> 买价,卖价,多仓隔夜利息,空仓隔夜利息,最低点位;</span><br><span class="line">   <span class="keyword">double</span> 点差,报价位数;</span><br><span class="line">   <span class="keyword">double</span> 最低单量;</span><br><span class="line">   </span><br><span class="line">   买价=MarketInfo(货币对名,MODE_ASK);</span><br><span class="line">   卖价=MarketInfo(货币对名,MODE_BID);</span><br><span class="line">   多仓隔夜利息=MarketInfo(货币对名,MODE_SWAPLONG);</span><br><span class="line">   空仓隔夜利息=MarketInfo(货币对名,MODE_SWAPSHORT);</span><br><span class="line">   点差=MarketInfo(货币对名,MODE_SPREAD);</span><br><span class="line">   报价位数=MarketInfo(货币对名,MODE_DIGITS);</span><br><span class="line">   最低点位=MarketInfo(货币对名,MODE_POINT);</span><br><span class="line">   最低单量=MarketInfo(货币对名,MODE_MINLOT);</span><br><span class="line">   </span><br><span class="line">   Print(<span class="string">"货币对      :"</span>, 货币对名     );</span><br><span class="line">   Print(<span class="string">"买价        :"</span>, 买价         );</span><br><span class="line">   Print(<span class="string">"卖价        :"</span>, 卖价         );</span><br><span class="line">   Print(<span class="string">"多仓隔夜利息:"</span>, 多仓隔夜利息 );</span><br><span class="line">   Print(<span class="string">"空仓隔夜利息:"</span>, 空仓隔夜利息 );</span><br><span class="line">   Print(<span class="string">"点差        :"</span>, 点差         );</span><br><span class="line">   Print(<span class="string">"报价位数    :"</span>, 报价位数     );</span><br><span class="line">   Print(<span class="string">"最低点位    :"</span>, 最低点位     );</span><br><span class="line">   Print(<span class="string">"最低单量    :"</span>, 最低单量     );  </span><br><span class="line"></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----订单类型-------</span></span><br><span class="line"><span class="comment">多单 OP_BUY</span></span><br><span class="line"><span class="comment">空单 OP_SELL</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">买入限价 OP_BUYLIMIT 等价位跌倒某值买入</span></span><br><span class="line"><span class="comment">买入止损 OP_SELLLIMIT 等价格涨到某值卖出</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">卖出限价 OP_BUYSTOP  等价格涨到某值买入（一般为突破多挂单）</span></span><br><span class="line"><span class="comment">卖出止损 OP_SELLSTOP 等价格跌倒某值卖出（一般为跌破空挂单）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">----------------------*/</span></span><br></pre></td></tr></table></figure>
<h3 id="修改订单函数"><a href="#修改订单函数" class="headerlink" title="修改订单函数"></a>修改订单函数</h3><p>MQL4中修改订单，使用OrderModify()函数。<br>对于已经下单的订单，能够修改的参数只有止损和止盈。<br>对于挂单，可以修改止损，止盈和开仓价</p>
<ul>
<li>修改订单</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*----------修改订单使用 OrderModify() 函数---</span></span><br><span class="line"><span class="comment">    本例将所有  多单的止损扩大100点</span></span><br><span class="line"><span class="comment">                空单的止盈扩大100点  </span></span><br><span class="line"><span class="comment">---------------------------------------------*/</span></span><br><span class="line"><span class="keyword">bool</span> res;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;OrdersTotal();i++)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(OrderSelect(i,SELECT_BY_POS,MODE_TRADES)==True)</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="keyword">if</span>(OrderType()==OP_BUY || OrderType()==OP_BUYLIMIT || OrderType()==OP_BUYSTOP)</span><br><span class="line">         &#123;</span><br><span class="line">            <span class="keyword">if</span>(OrderStopLoss()==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">               res=OrderModify(OrderTicket(),OrderOpenPrice(),MarketInfo(OrderSymbol(),MODE_ASK)<span class="number">-100</span>*MarketInfo(OrderSymbol(),MODE_POINT),OrderTakeProfit(),<span class="number">0</span>,clrNONE);</span><br><span class="line">               <span class="keyword">if</span>(res==<span class="literal">false</span>)</span><br><span class="line">                  Print(<span class="string">"多单修改失败，订单号："</span>,OrderTicket());</span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">               res=OrderModify(OrderTicket(),OrderOpenPrice(),OrderStopLoss()+<span class="number">100</span>*MarketInfo(OrderSymbol(),MODE_POINT),OrderTakeProfit(),<span class="number">0</span>,clrNONE);</span><br><span class="line">               <span class="keyword">if</span>(res==<span class="literal">false</span>)</span><br><span class="line">                  Print(<span class="string">"空单修改失败，订单号："</span>,OrderTicket());</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span>(OrderType()==OP_SELL || OrderType()==OP_SELLLIMIT || OrderType()==OP_SELLSTOP)</span><br><span class="line">         &#123;</span><br><span class="line">            <span class="keyword">if</span>(OrderTakeProfit()==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">               res=OrderModify(OrderTicket(),OrderOpenPrice(),OrderStopLoss(),MarketInfo(OrderSymbol(),MODE_BID)<span class="number">-100</span>*MarketInfo(OrderSymbol(),MODE_POINT),<span class="number">0</span>,clrNONE);</span><br><span class="line">               <span class="keyword">if</span>(res==<span class="literal">false</span>)</span><br><span class="line">                  Print(<span class="string">"空单修改失败，订单号："</span>,OrderTicket());                 </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">               res=OrderModify(OrderTicket(),OrderOpenPrice(),OrderStopLoss(),OrderTakeProfit()<span class="number">-100</span>*MarketInfo(OrderSymbol(),MODE_POINT),<span class="number">0</span>,clrNONE);</span><br><span class="line">               <span class="keyword">if</span>(res==<span class="literal">false</span>)</span><br><span class="line">                  Print(<span class="string">"空单修改失败，订单号："</span>,OrderTicket());              </span><br><span class="line">            &#125;        </span><br><span class="line">         &#125;</span><br><span class="line">      &#125;   </span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="平仓函数"><a href="#平仓函数" class="headerlink" title="平仓函数"></a>平仓函数</h3><p>MQL4对已开仓位使用平仓函数，可将仓位按当前价平仓。</p>
<h3 id="删除订单函数"><a href="#删除订单函数" class="headerlink" title="删除订单函数"></a>删除订单函数</h3><p>MQL4对未执行的挂单使用删除订单函数，将此挂单删除。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"><span class="comment">/*---------------------------------------------</span></span><br><span class="line"><span class="comment">平仓函数的使用需要慎重对待，必须使用订单号平仓，</span></span><br><span class="line"><span class="comment">一般的使用方式为先选中订单，然后再平仓。</span></span><br><span class="line"><span class="comment">本例：在图表周期中，若K线收盘价低于10日均线时，</span></span><br><span class="line"><span class="comment">平掉本货币对多仓</span></span><br><span class="line"><span class="comment">----------------------------------------------*/</span></span><br><span class="line">input <span class="keyword">int</span> 周期=<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> 魔数=<span class="number">1243</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">OnInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">   <span class="keyword">return</span>(INIT_SUCCEEDED);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnDeinit</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> reason)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnTick</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">   <span class="keyword">double</span> ma_value=iMA(Symbol(),<span class="number">0</span>,周期,<span class="number">0</span>,MODE_EMA,PRICE_CLOSE,<span class="number">0</span>);<span class="comment">//--调用均线指标</span></span><br><span class="line">   <span class="keyword">double</span> close_price=iClose(Symbol(),<span class="number">0</span>,<span class="number">0</span>); <span class="comment">//------调用收盘价</span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span>(close_price&lt;ma_value)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;OrdersTotal();i++)</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="keyword">if</span>(OrderSelect(i,SELECT_BY_POS,MODE_TRADES)==True)</span><br><span class="line">         &#123; </span><br><span class="line"><span class="comment">//----------------选择需要平仓的订单---------------、、           </span></span><br><span class="line">            <span class="keyword">if</span>(OrderSymbol()==Symbol() &amp;&amp; OrderMagicNumber()==魔数)</span><br><span class="line">            &#123;</span><br><span class="line"><span class="comment">//----------------开仓单使用OrderClose() ----------//</span></span><br><span class="line">               <span class="keyword">if</span>(OrderType()==OP_BUY)</span><br><span class="line">               &#123;</span><br><span class="line">                  <span class="keyword">if</span>(!OrderClose(OrderTicket(),OrderLots(),MarketInfo(Symbol(),MODE_BID),<span class="number">3</span>,clrNONE))</span><br><span class="line">                     Alert(<span class="string">"平仓失败，错误号："</span>,GetLastError());</span><br><span class="line">               &#125;</span><br><span class="line"><span class="comment">//-----------------挂单使用 OrderDelete() ----------//               </span></span><br><span class="line">               <span class="keyword">if</span>(OrderType()==OP_BUYLIMIT || OrderType()==OP_BUYSTOP)</span><br><span class="line">               &#123;</span><br><span class="line">                  <span class="keyword">if</span>(!OrderDelete(OrderTicket(),clrNONE))</span><br><span class="line">                     Alert(<span class="string">"删除挂单失败，错误号："</span>,GetLastError());</span><br><span class="line">               &#125;               </span><br><span class="line">            &#125;</span><br><span class="line">          &#125;  </span><br><span class="line">       &#125;     </span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="订单参数"><a href="#订单参数" class="headerlink" title="订单参数"></a>订单参数</h2><p>每一个订单都有自己的参数，在使用OrderSelect()选中订单的前提下，可使用内置函数调用订单参数。在未选中的情况下，无法返回参数。选择订单的两种方法：</p>
<ul>
<li>按订单号选择</li>
<li>按订单序列选择</li>
</ul>
<h3 id="订单号"><a href="#订单号" class="headerlink" title="订单号"></a>订单号</h3><p>使用OrderTicket()返回订单得订单号，数据类型为整型</p>
<h3 id="币种"><a href="#币种" class="headerlink" title="币种"></a>币种</h3><p>使用OrderSymbol()函数返回订单币种，类型为string（字符串）</p>
<h3 id="单量"><a href="#单量" class="headerlink" title="单量"></a>单量</h3><p>使用OrderLots()函数返回订单单量，类型为一个浮点数</p>
<h3 id="交易类型"><a href="#交易类型" class="headerlink" title="交易类型"></a>交易类型</h3><p>使用OrderType()函数返回订单方向，可能是OP_BUY,OP_SELL,OP_BUY_LIMIT,OP_BUY_STOP,OP_SELL_LIMIT,OP_SELL_STOP中的其中一个</p>
<h3 id="开仓价"><a href="#开仓价" class="headerlink" title="开仓价"></a>开仓价</h3><p>使用OrderOpenPrice()返回订单得订单开仓价，数据类型为整型</p>
<h3 id="开仓时间"><a href="#开仓时间" class="headerlink" title="开仓时间"></a>开仓时间</h3><p>使用OrderOpenTime()返回订单得订单开仓时间，数据类型为整型</p>
<h3 id="止损"><a href="#止损" class="headerlink" title="止损"></a>止损</h3><p>使用OrderStopLoss()返回订单得订单止损，数据类型为整型</p>
<h3 id="止盈"><a href="#止盈" class="headerlink" title="止盈"></a>止盈</h3><p>使用OrderTakeProfit()返回订单得订单止盈，数据类型为整型</p>
<h3 id="注释-1"><a href="#注释-1" class="headerlink" title="注释"></a>注释</h3><p>使用OrderComment()返回订单得订单注释，数据类型为整型</p>
<h3 id="魔数"><a href="#魔数" class="headerlink" title="魔数"></a>魔数</h3><p>使用OrderMagicNumber()返回订单得订单魔数，数据类型为整型</p>
<h3 id="平仓价"><a href="#平仓价" class="headerlink" title="平仓价"></a>平仓价</h3><p>使用OrderClosePrice()返回订单得订单平仓价，数据类型为整型</p>
<h3 id="平仓时间"><a href="#平仓时间" class="headerlink" title="平仓时间"></a>平仓时间</h3><p>使用OrderCloseTime()返回订单得订单平仓时间，数据类型为整型</p>
<h3 id="浮盈"><a href="#浮盈" class="headerlink" title="浮盈"></a>浮盈</h3><p>使用OrderProfit()返回订单得订单浮盈，数据类型为整型</p>
<h3 id="隔夜利息"><a href="#隔夜利息" class="headerlink" title="隔夜利息"></a>隔夜利息</h3><p>使用OrderSwap()返回订单得订单隔夜利息，数据类型为整型</p>
<h3 id="手续费"><a href="#手续费" class="headerlink" title="手续费"></a>手续费</h3><p>使用OrderCommission()返回订单得订单手续费，数据类型为整型</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"><span class="comment">/*--------------------------------</span></span><br><span class="line"><span class="comment">选择订单参数是自动交易中的重要步骤。</span></span><br><span class="line"><span class="comment">----------------------------------*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//-------------通用格式-----------</span></span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=OrdersTotal()<span class="number">-1</span>;i++) <span class="comment">//---------选择持仓订单</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(OrderSelect(i,SELECT_BY_POS,MODE_TRADES)) </span><br><span class="line">      &#123;</span><br><span class="line">         Print(<span class="string">"订单号："</span>,OrderTicket()); </span><br><span class="line">         Print(<span class="string">"币种："</span>,OrderSymbol());</span><br><span class="line">         Print(<span class="string">"方向："</span>,OrderType()); </span><br><span class="line">         Print(<span class="string">"单量："</span>,OrderLots()); </span><br><span class="line">         Print(<span class="string">"开仓价："</span>,OrderOpenPrice()); </span><br><span class="line">         Print(<span class="string">"开仓时间："</span>,OrderOpenTime()); </span><br><span class="line">         Print(<span class="string">"止损："</span>,OrderStopLoss()); </span><br><span class="line">         Print(<span class="string">"止盈："</span>,OrderTakeProfit()); </span><br><span class="line">         Print(<span class="string">"收盘价："</span>,OrderClosePrice()); </span><br><span class="line">         Print(<span class="string">"收盘时间："</span>,OrderCloseTime()); </span><br><span class="line">         Print(<span class="string">"魔数："</span>,OrderMagicNumber()); </span><br><span class="line">         Print(<span class="string">"注释："</span>,OrderComment());</span><br><span class="line">         Print(<span class="string">"浮盈："</span>,OrderProfit());</span><br><span class="line">         Print(<span class="string">"隔夜利息："</span>,OrderSwap());</span><br><span class="line">         Print(<span class="string">"手续费："</span>,OrderCommission());    </span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=OrdersHistoryTotal()<span class="number">-1</span>;i++) <span class="comment">//---------选择历史订单</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(OrderSelect(i,SELECT_BY_POS,MODE_HISTORY))</span><br><span class="line">      &#123;</span><br><span class="line">         Print(<span class="string">"订单号："</span>,OrderTicket()); </span><br><span class="line">         Print(<span class="string">"币种："</span>,OrderSymbol());</span><br><span class="line">         Print(<span class="string">"方向："</span>,OrderType()); </span><br><span class="line">         Print(<span class="string">"单量："</span>,OrderLots()); </span><br><span class="line">         Print(<span class="string">"开仓价："</span>,OrderOpenPrice()); </span><br><span class="line">         Print(<span class="string">"开仓时间："</span>,OrderOpenTime()); </span><br><span class="line">         Print(<span class="string">"止损："</span>,OrderStopLoss()); </span><br><span class="line">         Print(<span class="string">"止盈："</span>,OrderTakeProfit()); </span><br><span class="line">         Print(<span class="string">"收盘价："</span>,OrderClosePrice()); </span><br><span class="line">         Print(<span class="string">"收盘时间："</span>,OrderCloseTime()); </span><br><span class="line">         Print(<span class="string">"魔数："</span>,OrderMagicNumber()); </span><br><span class="line">         Print(<span class="string">"注释："</span>,OrderComment());</span><br><span class="line">         Print(<span class="string">"浮盈："</span>,OrderProfit());</span><br><span class="line">         Print(<span class="string">"隔夜利息："</span>,OrderSwap());</span><br><span class="line">         Print(<span class="string">"手续费："</span>,OrderCommission());    </span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">//------------直接按订单号选择-------</span></span><br><span class="line">   <span class="keyword">int</span> ticket=<span class="number">123</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span>(OrderSelect(ticket,SELECT_BY_TICKET)) <span class="comment">//----直接按订单号选择需输入正确订单号，很少用</span></span><br><span class="line">   &#123;</span><br><span class="line">         Print(<span class="string">"订单号："</span>,OrderTicket()); </span><br><span class="line">         Print(<span class="string">"币种："</span>,OrderSymbol());</span><br><span class="line">         Print(<span class="string">"方向："</span>,OrderType()); </span><br><span class="line">         Print(<span class="string">"单量："</span>,OrderLots()); </span><br><span class="line">         Print(<span class="string">"开仓价："</span>,OrderOpenPrice()); </span><br><span class="line">         Print(<span class="string">"开仓时间："</span>,OrderOpenTime()); </span><br><span class="line">         Print(<span class="string">"止损："</span>,OrderStopLoss()); </span><br><span class="line">         Print(<span class="string">"止盈："</span>,OrderTakeProfit()); </span><br><span class="line">         Print(<span class="string">"收盘价："</span>,OrderClosePrice()); </span><br><span class="line">         Print(<span class="string">"收盘时间："</span>,OrderCloseTime()); </span><br><span class="line">         Print(<span class="string">"魔数："</span>,OrderMagicNumber()); </span><br><span class="line">         Print(<span class="string">"注释："</span>,OrderComment());</span><br><span class="line">         Print(<span class="string">"浮盈："</span>,OrderProfit());</span><br><span class="line">         Print(<span class="string">"隔夜利息："</span>,OrderSwap());</span><br><span class="line">         Print(<span class="string">"手续费："</span>,OrderCommission()); </span><br><span class="line">   &#125;   </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="账户与市场信息"><a href="#账户与市场信息" class="headerlink" title="账户与市场信息"></a>账户与市场信息</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">   <span class="comment">//-- 账户信息</span></span><br><span class="line">   Print(<span class="string">"当前账户是模拟账户吗？答案："</span>,IsDemo());</span><br><span class="line">   Print(<span class="string">"当前账户编号："</span>,AccountNumber());</span><br><span class="line">   Print(<span class="string">"当前账户名称："</span>,AccountName());</span><br><span class="line">   Print(<span class="string">"当前账户余额："</span>,AccountBalance());</span><br><span class="line">   Print(<span class="string">"当前账户净值："</span>,AccountEquity());</span><br><span class="line">   Print(<span class="string">"当前账户杠杆："</span>,AccountLeverage());</span><br><span class="line">   Print(<span class="string">"当前账户公司："</span>,AccountCompany());</span><br><span class="line">   Print(<span class="string">"当前账户剩余保证金："</span>,AccountFreeMargin());</span><br><span class="line">   Print(<span class="string">"当前账户止损线："</span>,AccountStopoutLevel());</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//-- 市场信息</span></span><br><span class="line">   Print(<span class="string">"当前币种卖价："</span>,MarketInfo(Symbol(),MODE_ASK));</span><br><span class="line">   Print(<span class="string">"当前币种买价："</span>,MarketInfo(Symbol(),MODE_BID));</span><br><span class="line">   Print(<span class="string">"当前币种有几位小数："</span>,MarketInfo(Symbol(),MODE_DIGITS));</span><br><span class="line">   Print(<span class="string">"当前币种最小变动："</span>,MarketInfo(Symbol(),MODE_POINT));</span><br><span class="line">   Print(<span class="string">"当前币种点值："</span>,MarketInfo(Symbol(),MODE_TICKVALUE));</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//-- 终端信息</span></span><br><span class="line">   Print(<span class="string">"终端名："</span>,TerminalName());</span><br><span class="line">   Print(<span class="string">"终端路径："</span>,TerminalPath());</span><br><span class="line">   Print(<span class="string">"终端公司："</span>,TerminalCompany());</span><br><span class="line">   Print(<span class="string">"终端公共数据文件夹："</span>,TerminalInfoString(TERMINAL_COMMONDATA_PATH));  </span><br><span class="line">   Print(<span class="string">"终端文件夹："</span>,TerminalInfoString(TERMINAL_DATA_PATH));  <span class="comment">//-- 右侧 Files文件夹路径</span></span><br><span class="line">   Print(<span class="string">"关闭终端指令 TerminalClose() "</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="常用指标"><a href="#常用指标" class="headerlink" title="常用指标"></a>常用指标</h2><h3 id="均线指标"><a href="#均线指标" class="headerlink" title="均线指标"></a>均线指标</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//---------- 默认币种4小时周期，前三根K线14日均线值 -----------//</span></span><br><span class="line"> </span><br><span class="line">   <span class="built_in">string</span> 币种=Symbol(); <span class="comment">//----币种Symbol为图表币种，也可直接定义如“EURUSD”</span></span><br><span class="line">   <span class="keyword">int</span> 时间周期=<span class="number">240</span>;     <span class="comment">//----时间周期指图表周期，240（分钟）是4小时图，使用0，则默认图表周期</span></span><br><span class="line">   <span class="keyword">int</span> 均线周期=<span class="number">14</span>;      <span class="comment">//----均线周期，本例指14均线</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">double</span> ma_0=iMA(币种,时间周期,均线周期,<span class="number">0</span>,MODE_EMA,PRICE_CLOSE,<span class="number">0</span>);  <span class="comment">//---最后一个参数表示第几根k线，0是从右往左第一根，即最近的一根K线</span></span><br><span class="line">   <span class="keyword">double</span> ma_1=iMA(币种,时间周期,均线周期,<span class="number">0</span>,MODE_EMA,PRICE_CLOSE,<span class="number">1</span>);  <span class="comment">//---第二根，从右往左。注意第n+1根K线的标号为n。</span></span><br><span class="line">   <span class="keyword">double</span> ma_2=iMA(币种,时间周期,均线周期,<span class="number">0</span>,MODE_EMA,PRICE_CLOSE,<span class="number">2</span>);  </span><br><span class="line"></span><br><span class="line">   PrintFormat(<span class="string">"前三根K线均线值为：%.5f,%.5f,%.5f"</span>,ma_0,ma_1,ma_2);</span><br><span class="line">   </span><br><span class="line"><span class="comment">//---------- 获取 EURUSD 日线50日周期的前日收盘均线值 -----------//  </span></span><br><span class="line">   <span class="keyword">double</span> ma_eurusd=iMA(<span class="string">"EURUSD"</span>,PERIOD_D1,<span class="number">50</span>,<span class="number">0</span>,MODE_EMA,PRICE_CLOSE,<span class="number">1</span>);  </span><br><span class="line">   PrintFormat(<span class="string">"EURUSD的均线值为：%.5f"</span>,ma_eurusd); </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="MACD指标"><a href="#MACD指标" class="headerlink" title="MACD指标"></a>MACD指标</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    设置币种4小时周期，前根K线MACD值,MACD有2个返回值macd的值，与macd的均线值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   <span class="built_in">string</span> 币种=Symbol(); <span class="comment">//----币种Symbol为图表币种，也可直接定义如“EURUSD”</span></span><br><span class="line">   <span class="keyword">int</span> 时间周期=<span class="number">240</span>;     <span class="comment">//----时间周期指图表周期，240（分钟）是4小时图，使用0，则默认图表周期</span></span><br><span class="line">   <span class="keyword">int</span> 慢周期=<span class="number">26</span>,快周期=<span class="number">12</span>,均滑周期=<span class="number">9</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">double</span> macd_main=iMACD(币种,时间周期,快周期,慢周期,均滑周期,PRICE_CLOSE,MODE_MAIN,<span class="number">1</span>);  <span class="comment">//---最后一个参数表示第几根k线，0是从右往左第一根，即最近的一根K线</span></span><br><span class="line">   <span class="keyword">double</span> macd_signal=iMACD(币种,时间周期,快周期,慢周期,均滑周期,PRICE_CLOSE,MODE_SIGNAL,<span class="number">1</span>);  <span class="comment">//---第二根，从右往左。注意第n+1根K线的标号为n。</span></span><br><span class="line"></span><br><span class="line">   PrintFormat(<span class="string">"MACD值为：%.5f,SIGNAL：%.5f"</span>,macd_main,macd_signal);</span><br><span class="line">   </span><br><span class="line"><span class="comment">//---------- 获取 EURUSD 日线当前MACD值 -----------//  </span></span><br><span class="line">   macd_main=iMACD(<span class="string">"EURUSD"</span>,PERIOD_D1,快周期,慢周期,均滑周期,PRICE_CLOSE,MODE_MAIN,<span class="number">0</span>);  <span class="comment">//---最后一个参数表示第几根k线，0是从右往左第一根，即最近的一根K线</span></span><br><span class="line">   macd_signal=iMACD(<span class="string">"EURUSD"</span>,PERIOD_D1,快周期,慢周期,均滑周期,PRICE_CLOSE,MODE_SIGNAL,<span class="number">0</span>);  <span class="comment">//---第二根，从右往左。注意第n+1根K线的标号为n。</span></span><br><span class="line"></span><br><span class="line">   PrintFormat(<span class="string">"MACD值为：%.5f,SIGNAL：%.5f"</span>,macd_main,macd_signal);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="RSI"><a href="#RSI" class="headerlink" title="RSI"></a>RSI</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//---------- 设置币种4小时周期，前三根K线14日RSI值 -----------//</span></span><br><span class="line"> </span><br><span class="line">   <span class="built_in">string</span> 币种=Symbol(); <span class="comment">//----币种Symbol为图表币种，也可直接定义如“EURUSD”</span></span><br><span class="line">   <span class="keyword">int</span> 时间周期=<span class="number">240</span>;     <span class="comment">//----时间周期指图表周期，240（分钟）是4小时图，使用0，则默认图表周期</span></span><br><span class="line">   <span class="keyword">int</span> RSI周期=<span class="number">14</span>;      <span class="comment">//----均线周期，本例指14均线</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">double</span> rsi_0=iRSI(币种,时间周期,RSI周期,PRICE_CLOSE,<span class="number">0</span>);  <span class="comment">//---最后一个参数表示第几根k线，0是从右往左第一根，即最近的一根K线</span></span><br><span class="line">   <span class="keyword">double</span> rsi_1=iRSI(币种,时间周期,RSI周期,PRICE_CLOSE,<span class="number">1</span>);  <span class="comment">//---第二根，从右往左。注意第n+1根K线的标号为n。</span></span><br><span class="line">   <span class="keyword">double</span> rsi_2=iRSI(币种,时间周期,RSI周期,PRICE_CLOSE,<span class="number">2</span>);  </span><br><span class="line"></span><br><span class="line">   PrintFormat(<span class="string">"前三根K线RSI值为：%.5f,%.5f,%.5f"</span>,rsi_0,rsi_1,rsi_2);</span><br><span class="line">   </span><br><span class="line"><span class="comment">//---------- 获取 EURUSD 日线日收盘RSI值 -----------//  </span></span><br><span class="line">   <span class="keyword">double</span> rsi_eurusd=iRSI(<span class="string">"EURUSD"</span>,PERIOD_D1,<span class="number">14</span>,PRICE_CLOSE,<span class="number">1</span>);  </span><br><span class="line">   PrintFormat(<span class="string">"EURUSD日线的RSI值为：%.5f"</span>,rsi_eurusd); </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="实例1：均线交叉策略"><a href="#实例1：均线交叉策略" class="headerlink" title="实例1：均线交叉策略"></a>实例1：均线交叉策略</h2><p>短期均线在长期均线之上，macd金叉做多。遇死叉平仓<br>短期均线在长期均线之下，macd死叉做空。遇金叉平仓<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> lot=<span class="number">0.1</span>;</span><br><span class="line"><span class="comment">//--- macd指标参数</span></span><br><span class="line"><span class="keyword">int</span> macd_fast=<span class="number">12</span>;</span><br><span class="line"><span class="keyword">int</span> macd_slow=<span class="number">26</span>;</span><br><span class="line"><span class="keyword">int</span> macd_signal=<span class="number">9</span>;</span><br><span class="line"><span class="comment">//--- 均线指标参数</span></span><br><span class="line"><span class="keyword">int</span> ma_period=<span class="number">60</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//--- EA参数：识别码</span></span><br><span class="line"><span class="keyword">int</span> Magic_Num=<span class="number">124243</span>;</span><br><span class="line"><span class="built_in">string</span> comment =<span class="string">"test"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//--- 策略变量</span></span><br><span class="line"><span class="keyword">bool</span> gold_cross=False,dead_cross=False;</span><br><span class="line">datetime time_flag=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">//| Expert initialization function                                   |</span></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">OnInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//---</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">//---</span></span><br><span class="line">   <span class="keyword">return</span>(INIT_SUCCEEDED);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">//| Expert deinitialization function                                 |</span></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnDeinit</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> reason)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//---</span></span><br><span class="line">   </span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">//| Expert tick function                                             |</span></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnTick</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//-- 平仓部分</span></span><br><span class="line">   <span class="keyword">double</span> macd_4_main_value,macd_4_main_value_prv,macd_4_signal_value,macd_4_signal_value_prv;  </span><br><span class="line">   macd_4_main_value = iMACD(Symbol(),PERIOD_H4,macd_fast,macd_slow,macd_signal,PRICE_CLOSE,MODE_MAIN,<span class="number">1</span>);</span><br><span class="line">   macd_4_main_value_prv = iMACD(Symbol(),PERIOD_H4,macd_fast,macd_slow,macd_signal,PRICE_CLOSE,MODE_MAIN,<span class="number">2</span>);   </span><br><span class="line"></span><br><span class="line">   macd_4_signal_value = iMACD(Symbol(),PERIOD_H4,macd_fast,macd_slow,macd_signal,PRICE_CLOSE,MODE_SIGNAL,<span class="number">1</span>);</span><br><span class="line">   macd_4_signal_value_prv = iMACD(Symbol(),PERIOD_H4,macd_fast,macd_slow,macd_signal,PRICE_CLOSE,MODE_SIGNAL,<span class="number">2</span>); </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;OrdersTotal();i++)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(OrderSelect(i,SELECT_BY_POS,MODE_TRADES) &amp;&amp; OrderSymbol()==Symbol() &amp;&amp; OrderMagicNumber()==Magic_Num)</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="keyword">if</span>(OrderType()==OP_BUY)</span><br><span class="line">         &#123;</span><br><span class="line">            <span class="keyword">if</span>(macd_4_main_value&lt;macd_4_signal_value &amp;&amp; macd_4_main_value_prv&gt;macd_4_signal_value_prv)</span><br><span class="line">               OrderClose(OrderTicket(),OrderLots(),Bid,<span class="number">3</span>,clrNONE);<span class="comment">//--- 4小时死叉平仓</span></span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span>(OrderType()==OP_SELL)</span><br><span class="line">         &#123;</span><br><span class="line">            <span class="keyword">if</span>(macd_4_main_value&gt;macd_4_signal_value &amp;&amp; macd_4_main_value_prv&lt;macd_4_signal_value_prv)</span><br><span class="line">               OrderClose(OrderTicket(),OrderLots(),Ask,<span class="number">3</span>,clrNONE);<span class="comment">//--- 4小时金叉平仓</span></span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//-- 开仓部分</span></span><br><span class="line">   <span class="keyword">if</span>(time_flag==iTime(Symbol(),<span class="number">0</span>,<span class="number">0</span>)) <span class="comment">//-- 每根K线做一次开仓判断</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   time_flag= iTime(Symbol(),<span class="number">0</span>,<span class="number">0</span>);  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;OrdersTotal();i++)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(OrderSelect(i,SELECT_BY_POS,MODE_TRADES) &amp;&amp; OrderSymbol()==Symbol() &amp;&amp; OrderMagicNumber()==Magic_Num)</span><br><span class="line">         <span class="keyword">return</span>;<span class="comment">//--订单已存在，不再继续下单</span></span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">double</span> ma_value,ma_value_prv,macd_main_value,macd_main_value_prv,macd_signal_value,macd_signal_value_prv;</span><br><span class="line">   ma_value = iMA(Symbol(),PERIOD_D1,ma_period,<span class="number">0</span>,MODE_EMA,PRICE_CLOSE,<span class="number">1</span>);</span><br><span class="line">   ma_value_prv = iMA(Symbol(),PERIOD_D1,ma_period,<span class="number">0</span>,MODE_EMA,PRICE_CLOSE,<span class="number">2</span>);</span><br><span class="line">   </span><br><span class="line">   macd_main_value = iMACD(Symbol(),PERIOD_D1,macd_fast,macd_slow,macd_signal,PRICE_CLOSE,MODE_MAIN,<span class="number">1</span>);</span><br><span class="line">   macd_main_value_prv = iMACD(Symbol(),PERIOD_D1,macd_fast,macd_slow,macd_signal,PRICE_CLOSE,MODE_MAIN,<span class="number">2</span>);   </span><br><span class="line"></span><br><span class="line">   macd_signal_value = iMACD(Symbol(),PERIOD_D1,macd_fast,macd_slow,macd_signal,PRICE_CLOSE,MODE_SIGNAL,<span class="number">1</span>);</span><br><span class="line">   macd_signal_value_prv = iMACD(Symbol(),PERIOD_D1,macd_fast,macd_slow,macd_signal,PRICE_CLOSE,MODE_SIGNAL,<span class="number">2</span>); </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span>(ma_value&gt;ma_value_prv)<span class="comment">//-- 均线向上</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(macd_main_value&gt;macd_signal_value &amp;&amp; macd_main_value_prv&lt;macd_signal_value_prv)<span class="comment">//--- macd金叉</span></span><br><span class="line">         OrderSend(Symbol(),OP_BUY,lot,Ask,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,comment,Magic_Num,<span class="number">0</span>,clrNONE); <span class="comment">//--下多单</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(ma_value&lt;ma_value_prv)<span class="comment">//-- 均线向下</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(macd_main_value&lt;macd_signal_value &amp;&amp; macd_main_value_prv&gt;macd_signal_value_prv)<span class="comment">//--- macd死叉</span></span><br><span class="line">         OrderSend(Symbol(),OP_SELL,lot,Bid,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,comment,Magic_Num,<span class="number">0</span>,clrNONE); <span class="comment">//--下空单</span></span><br><span class="line">   &#125;   </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="实例2：逆势加仓-做多方向"><a href="#实例2：逆势加仓-做多方向" class="headerlink" title="实例2：逆势加仓-做多方向"></a>实例2：逆势加仓-做多方向</h2><p>EA无订单时，RSI 大于50开多单，每下跌”加仓间距点数”的距离就加开一单，单量是前一单的1.2倍，平均每单盈利300点时，全部平仓<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#property copyright <span class="meta-string">"shiyingpan"</span></span></span><br><span class="line"><span class="meta">#property link      <span class="meta-string">"https://aijy.github.io"</span></span></span><br><span class="line"><span class="meta">#property version   <span class="meta-string">"1.00"</span></span></span><br><span class="line"><span class="meta">#property strict</span></span><br><span class="line"></span><br><span class="line">input <span class="keyword">int</span> rsi_period=<span class="number">14</span>;</span><br><span class="line">input <span class="keyword">double</span> lot=<span class="number">0.1</span>;</span><br><span class="line">input <span class="keyword">int</span> 止盈点数=<span class="number">300</span>;</span><br><span class="line">input <span class="keyword">int</span> 加仓间距点数=<span class="number">500</span>;</span><br><span class="line">input <span class="keyword">double</span> 加仓倍数=<span class="number">1.2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> Magic_Num=<span class="number">23424</span>;</span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">//| Expert initialization function                                   |</span></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">OnInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//---</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">//---</span></span><br><span class="line">   <span class="keyword">return</span>(INIT_SUCCEEDED);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">//| Expert deinitialization function                                 |</span></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnDeinit</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> reason)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//---</span></span><br><span class="line">   </span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">//| Expert tick function                                             |</span></span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnTick</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="comment">//--开仓部分</span></span><br><span class="line"><span class="comment">//-- 仓位判断</span></span><br><span class="line">   <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">double</span> last_order_price=<span class="number">0</span>,rsi_value=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">double</span> total_price=<span class="number">0</span>,avg_price,total_lots=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;OrdersTotal();i++) <span class="comment">//--- for(int i=OrdersTotal()-1;i&gt;=0;i--)</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(OrderSelect(i,SELECT_BY_POS,MODE_TRADES) &amp;&amp; OrderSymbol()==Symbol() &amp;&amp; OrderMagicNumber()==Magic_Num)</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="keyword">if</span>(OrderType()==OP_BUY)</span><br><span class="line">         &#123;</span><br><span class="line">            count=count+<span class="number">1</span>;</span><br><span class="line">            last_order_price=OrderOpenPrice();</span><br><span class="line">            total_price=total_price+OrderLots()*OrderOpenPrice();</span><br><span class="line">            total_lots = total_lots+OrderLots();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(count==<span class="number">0</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      rsi_value=iRSI(Symbol(),PERIOD_M5,<span class="number">14</span>,PRICE_CLOSE,<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span>(rsi_value&gt;<span class="number">50</span>)</span><br><span class="line">      &#123;</span><br><span class="line">         OrderSend(Symbol(),OP_BUY,lot,Ask,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,IntegerToString(count+<span class="number">1</span>),Magic_Num,<span class="number">0</span>,clrNONE);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(last_order_price-Ask&gt;加仓间距点数*Point)</span><br><span class="line">      &#123;</span><br><span class="line">         OrderSend(Symbol(),OP_BUY,lot*NormalizeDouble(MathPow(<span class="number">1.2</span>,count),<span class="number">2</span>),Ask,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,IntegerToString(count+<span class="number">1</span>),Magic_Num,<span class="number">0</span>,clrNONE);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//---平仓部分   </span></span><br><span class="line">      avg_price=total_price/total_lots;</span><br><span class="line">      <span class="keyword">if</span>(Ask-avg_price&gt;<span class="number">300</span>*Point)</span><br><span class="line">         CloseAll();</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//+------------------------------------------------------------------+</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CloseAll</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;OrdersTotal();i++) </span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(OrderSelect(i,SELECT_BY_POS,MODE_TRADES) &amp;&amp; OrderSymbol()==Symbol() &amp;&amp; OrderMagicNumber()==Magic_Num)</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="keyword">if</span>(OrderType()==OP_BUY)</span><br><span class="line">         &#123;</span><br><span class="line">            OrderClose(OrderTicket(),OrderLots(),Bid,<span class="number">3</span>,clrNONE);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="历史回测与优化"><a href="#历史回测与优化" class="headerlink" title="历史回测与优化"></a>历史回测与优化</h2><p>MT4平台支持历史回测和优化，但其功能远不如MT5强大，具体见视频演示。</p>
<h3 id="编程风格"><a href="#编程风格" class="headerlink" title="编程风格"></a>编程风格</h3><p>养成良好的编程风格</p>
<ul>
<li>良好的书写格式，有助于理清思路，检验策略，查找错误，美观，这是基本功。</li>
<li>多使用函数，对于一个功能块，使用一个函数代替。</li>
<li>多次使用的字符串或数字，用一个标示符代替。</li>
<li>使用MetaEditor的自带编程风格工具</li>
</ul>

</div>


    <div class="post-guide">
        <div class="item left">
            
        </div>
        <div class="item right">
            
              <a href="../MQL4进阶课程/MQL4进阶课程.html">
                MQL4进阶课程
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>



	<div id="vcomments"></div>


<script>
	
		// 评论
		new Valine({
			av: AV,
			el: '#vcomments',
			notify: false,
			verify: false,
			path: window.location.pathname,
			appId: '',
			appKey: '',
			placeholder: '请输入评论',
			avatar: 'retro',
			recordIP: false
		})
	
	
</script>
	</div>
	<div id="footer">
	<p>
	©2019-<span id="footerYear"></span> 
	<a href="/">时应盼</a> 
	
	
		|
		<span id="busuanzi_container_site_pv">
			pv
			<span id="busuanzi_value_site_pv"></span>
		</span>
		|
		<span id="busuanzi_container_site_uv"> 
			uv
			<span id="busuanzi_value_site_uv"></span>
		</span>
	
	<br>
	Theme <a href="//github.com/wujun234/hexo-theme-tree" target="_blank">Tree</a>
	by <a href="//github.com/wujun234" target="_blank">WuJun</a>
	Powered by <a href="//hexo.io" target="_blank">Hexo</a>
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>